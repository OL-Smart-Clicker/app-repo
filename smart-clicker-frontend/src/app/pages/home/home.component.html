<!-- QOTD Bar -->
<app-spinner *ngIf="loading" class="my-8 mx-auto block"></app-spinner>
<div *ngIf="!loading">
  <div
    class="w-full flex flex-col sm:flex-row items-center justify-between bg-white rounded-xl shadow p-4 mt-6 mb-8 max-w-5xl mx-auto">
    <div class="flex-1 flex items-center justify-center">
      <span class="text-lg sm:text-xl md:text-2xl font-medium text-primary-blue">Today's question:</span>
      <span class="ml-2 text-lg sm:text-xl md:text-2xl font-semibold text-primary-black">{{ qotd }}</span>
    </div>
    <div class="mt-2 sm:mt-0 sm:ml-4 flex-shrink-0">
      <span
        class="inline-block bg-primary-light-blue text-primary-blue font-mono text-lg px-4 py-2 rounded-lg shadow-sm">
        {{ currentTime }}
      </span>
    </div>
  </div>

  <!-- Dashboard Grid -->
  <div class="max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-6">
    <!-- Total Clicks This Week -->
    <div class="bg-white rounded-xl shadow p-6 flex flex-col items-center justify-center min-h-[120px]">
      <div class="text-lg font-semibold mb-2 text-primary-blue">Total Clicks this week</div>
      <div class="text-3xl font-bold text-primary-blue" *ngIf="clicksWeek > 0">{{clicksWeek}}</div>
      <span *ngIf="clicksWeek === 0" class="text-secondary-blue">No data.</span>
    </div>
    <!-- Total Clicks -->
    <div class="bg-white rounded-xl shadow p-6 flex flex-col items-center justify-center min-h-[120px]">
      <div class="text-lg font-semibold mb-2 text-primary-blue">Total Clicks</div>
      <div class="text-3xl font-bold text-primary-blue" *ngIf="clicksAll > 0">{{clicksAll}}</div>
      <span *ngIf="clicksAll === 0" class="text-secondary-blue">No data.</span>
    </div>
    <!-- Office Map with Anchors -->
    <div class="bg-white rounded-xl shadow p-4 flex flex-col items-center justify-center min-h-[120px] md:col-span-2">
      <div class="w-full rounded-lg flex items-center justify-center relative overflow-hidden">
        <ng-container *ngIf="floorPlan">
          <div class="relative flex items-center justify-center w-full h-full">
            <img #floorImg [src]="floorPlan" alt="Floor Plan"
              class="max-h-64 object-contain rounded border block mx-auto" (load)="onDetailsImageLoad(floorImg)" />
            <ng-container *ngIf="anchors">
              <!-- <div *ngFor="let anchor of anchors; let i = index"
                class="absolute w-5 h-5 bg-blue-500 rounded-full border-2 border-white flex items-center justify-center anchor-dot z-100"
                [style.left.px]="anchor.x * detailsImageWidth - 10 + ((floorImg.offsetLeft || 0))"
                [style.top.px]="anchor.y * detailsImageHeight - 10 + ((floorImg.offsetTop || 0))">
                <span class="text-xs text-white">{{i+1}}</span>
              </div> -->
              <div *ngFor="let pos of trilateratedPositions; let idx = index"
                class="absolute w-3 h-3 bg-red-600 rounded-full border-2 border-white flex items-center justify-center z-200 animate-pulse"
                [style.left.px]="pos.x - 6 + ((floorImg.offsetLeft || 0))"
                [style.top.px]="pos.y - 6 + ((floorImg.offsetTop || 0))">
              </div>
            </ng-container>
          </div>
        </ng-container>
        <span *ngIf="!floorPlan" class="text-secondary-blue">No floorplan uploaded.</span>
      </div>
    </div>
    <!-- Week Overview Chart Placeholder -->
    <div class="bg-white rounded-xl shadow p-6 flex flex-col items-center justify-center min-h-[180px] md:col-span-2">
      <div class="text-lg font-semibold mb-2 text-primary-blue">Week Overview</div>
      <app-bar-chart *ngIf="clickerDataWeek.length > 0" [data]="clickerDataWeek"></app-bar-chart>
      <span *ngIf="clickerDataWeek.length === 0" class="text-secondary-blue">No data.</span>
    </div>
    <!-- Engagement Heatmap Placeholder -->
    <div class="bg-white rounded-xl shadow p-6 flex flex-col items-center justify-center min-h-[180px] md:col-span-2">
      <div class="text-lg font-semibold mb-2 text-primary-blue">Engagement Heatmap</div>
      <app-engagement-chart *ngIf="clickerDataYear.length > 0" [data]="clickerDataYear"></app-engagement-chart>
      <span *ngIf="clickerDataYear.length === 0" class="text-secondary-blue">No data.</span>
    </div>
  </div>
</div>